import{D as g}from"./chunk-KHP3ISOL.js";import{e as u,p as f}from"./chunk-SFZRBL3L.js";import{$ as d,X as p,a as c,b as l,ea as a,fb as h}from"./chunk-U23DJU6U.js";var i=class extends Error{};i.prototype.name="InvalidTokenError";function k(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,n)=>{let t=n.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function w(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return k(e)}catch{return atob(e)}}function m(o,e){if(typeof o!="string")throw new i("Invalid token specified: must be a string");e||(e={});let n=e.header===!0?0:1,t=o.split(".")[n];if(typeof t!="string")throw new i(`Invalid token specified: missing part #${n+1}`);let r;try{r=w(t)}catch(s){throw new i(`Invalid token specified: invalid base64 for part #${n+1} (${s.message})`)}try{return JSON.parse(r)}catch(s){throw new i(`Invalid token specified: invalid json for part #${n+1} (${s.message})`)}}var E=(()=>{let e=class e{constructor(t,r){this.http=t,this.router=r,this._authUser=h(null),this.tokenExpired(),this.isLogged()}get authUser(){return this._authUser.asReadonly()}logIn(t){return this.http.post(`${g.API_URL}/auth/login`,t).pipe(p(r=>this.saveUserAuthenticated(r)))}saveUserAuthenticated(t){this._authUser.set(t),localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("token",t.token)}getTokenStore(){return localStorage.getItem("token")}decodeToken(t){try{return m(t)}catch{return null}}tokenExpired(){let t=this.getTokenStore();if(!t)return null;let r=this.decodeToken(t);Math.floor(new Date().getTime()/1e3)>=r.exp&&this.logOut()}isLogged(){let t=this.getTokenStore(),r=this.decodeToken(t);t&&this._authUser.set(l(c({},r),{token:t}))}logOut(){this._authUser.set(null),localStorage.clear(),this.router.navigate(["/auth/login"])}};e.\u0275fac=function(r){return new(r||e)(a(u),a(f))},e.\u0275prov=d({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();export{E as a};
